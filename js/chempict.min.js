!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ChemPict=e():t.ChemPict=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){"use strict";var r=n(2).version,o=n(3),i=n(25),a=n(26),s=n(32),u={SmilesParser:o,WriteChemdoodleJson:function(t){return new i(t)},CoordinateGenerator:a,SvgDepict:s,getVersion:r};t.exports=u},function(t,e){t.exports={name:"chempict",version:"0.1.2",description:"Depict chemical pictures for the web.",main:"dist/chempict.min.js",files:["dist/chempict.min.js"],dependencies:{},devDependencies:{"babel-core":"^6.7.2","babel-loader":"^6.2.4","babel-preset-es2015":"^6.6.0",chai:"^3.5.0","clang-format":"^1.0.34",eslint:"^2.2.0","eslint-config-google":"^0.4.0","gh-pages":"^0.11.0",install:"^0.6.0",jsdoc:"^3.4.0","json-loader":"^0.5.4",mocha:"^2.4.5",npm:"^3.8.2",sinon:"^1.17.3",webpack:"^1.12.14"},engines:{node:">=5.0.0"},scripts:{build:"webpack --progress --colors","build:watch":"webpack --progress --colors --watch",clean:"rm -f ./doc/js/chempict.min.js",doc:"npm run clean && jsdoc ./src -r -d doc/jsdoc && cp ./dist/chempict.min.js ./doc/js/","doc:dev":"npm run clean && ln -rs ./dist/chempict.min.js ./doc/js/",fix:"eslint --fix src/**/*.js",format:"clang-format -i ./src/**/*.js",lint:"eslint ./src/**/*.js","publish-gh":"npm run build && npm run doc && node ./scripts/publish2ghpages.js",test:"mocha --es_staging","test:watch":"mocha --es_staging --watch"},repository:{type:"git",url:"git+https://github.com/benjaminabel/chempict.git"},keywords:["chemistry","molecule","svg","smiles","depict"],author:"Benjamin Abel",license:"Apache-2.0",bugs:{url:"https://github.com/benjaminabel/chempict/issues"},homepage:"https://github.com/benjaminabel/chempict#readme"}},function(t,e,n){"use strict";var r=n(4),o=n(10),i=n(11),a={};a.BondType={NONE:"NONE",SINGLE_BOND:"-",DOUBLE_BOND:"=",TRIPLE_BOND:"#",QUAD_BOND:"$",AROMATIC_BOND:":",ANY:"~"},a.BondStereo={NONE:"NONE",CLOCKWISE:"@",COUNTER_CLOCKWISE:"@@"},a.punctuation={nobond:".",openbranch:"(",closebranch:")",singlebond:a.BondType.SINGLE_BOND,doublebond:a.BondType.DOUBLE_BOND,triplebond:a.BondType.TRIPLE_BOND,quadbond:a.BondType.QUAD_BOND,aromaticbond:a.BondType.AROMATIC_BOND,ringclosure:"%",cis:"/",trans:"\\"},a.smiPattern=new RegExp(/\[[^[]+\]|Br|B|Cl|C|N|F|O|P]|S|c|n|o|s|-|=[0-9]|=[0-9]|=|#[0-9]|#[0-9][0-9]|#|\$|%[0-9][0-9]|[0-9]|\(|\)|./g),a.atomPattern=new RegExp(/^\[([0-9]*)([A-Z][a-z]?|c|n|o|se|s|as)(@|@@)?(H)?([0-9])?([+-][\d]?)?\]$/),a.specialAtoms=["C","c","N","n","O","o","S","s","P","F","Br","Cl","I","B"],a.aromaticAtoms=["c","n","o","s","as","se"],a.parse=function(t){for(var e,n=t.match(a.smiPattern),o=new i(t),s=0,u=a.BondType.NONE,c=[],l=[],f=[],d="",h=[],m=0;m<n.length;m++){var g=n[m],p=parseInt(g[1]+g[2],10);if(g===a.punctuation.nobond);else if(g===a.punctuation.openbranch)c.push(e);else if(g===a.punctuation.closebranch)c.length?e=c.pop():d=" Unbalanced parents";else if(g===a.punctuation.singlebond)u=a.BondType.SINGLE_BOND;else if(g===a.punctuation.doublebond)u=a.BondType.DOUBLE_BOND;else if(g===a.punctuation.triplebond)u=a.BondType.TRIPLE_BOND;else if(g===a.punctuation.quadbond)u=a.BondType.QUAD_BOND;else if(g===a.punctuation.aromaticbond)u=a.BondType.AROMATIC_BOND;else if(g[0]===a.punctuation.ringclosure){var y=l[p];y?(o.addBond(a.createBond(u,e,y)),u=a.BondType.NONE,l[p]=null):l[p]=e}else if(g===a.punctuation.cis);else if(g===a.punctuation.trans);else if(isNaN(p=parseInt(g,10)))if(g.length>1&&(g.startsWith(a.BondType.DOUBLE_BOND)||g.startsWith(a.BondType.TRIPLE_BOND)||g.startsWith(a.BondType.QUAD_BOND))&&!isNaN(p=parseInt(g.substr(1),10)))ringAtom=l[p],ringAtom?(o.addBond(a.createBond(f[p],e,ringAtom)),u=a.BondType.NONE,l[p]=null,f[p]=null):(l[p]=e,f[p]=g.substr(0,1));else{var v=a.parseAtom(g);if(v.symbol){s+=1;var b=new r(v.symbol,0,0,v.charge,v.aromatic,v.isotope);e&&(o.addBond(a.createBond(u,e,b)),u=a.BondType.NONE),o.addAtom(b),"NONE"!==v.stereo&&(h.push(o.indexOfAtom(b)),h.push(v.stereo),h.push(v.chiralHydrogenNeighbour)),e=b}else d=" unknown atom "+g}else{var x=l[p];x?(o.addBond(a.createBond(u,e,x)),u=a.BondType.NONE,l[p]=null):l[p]=e}if(d)throw new Error(t+d)}return a.setChiralCenters(o,h),a.sanityCheck(c,l,u)?o:null},a.sanityCheck=function(t,e,n){if(t.length)throw new Error("unbalanced parens");for(var r=0;r<e.length;++r)if(e[r])throw new Error("unclosed rings");if(n!==a.BondType.NONE)throw new Error("unpaired bond "+n);return!0},a.parseAtom=function(t){var e={isotope:null,symbol:null,stereo:a.BondStereo.NONE,hcount:null,charge:null,aromatic:!1,chiralHydrogenNeighbour:!1},n=a.atomPattern.exec(t);return n?(e.isotope=n[1],a.periodicTable[n[2]]&&(e.symbol=n[2]),n[3]===a.BondStereo.CLOCKWISE||n[3]===a.BondStereo.COUNTER_CLOCKWISE?(e.stereo=n[3],"H"===n[4]&&(e.chiralHydrogenNeighbour=!0)):e.stereo=a.BondStereo.NONE,"H"===n[4]&&(n[5]?e.hcount=n[5]:e.hcount=1),"+"===n[6]?e.charge=1:"-"===n[6]?e.charge=-1:e.charge=parseInt(n[6],10)):a.specialAtoms.includes(t)&&(e.symbol=t),a.aromaticAtoms.includes(e.symbol)&&(e.aromatic=!0,1===e.symbol.length?e.symbol=e.symbol.toUpperCase():e.symbol=e.symbol[0].toUpperCase()+e.symbol[1]),e},a.createBond=function(t,e,n){var r=t;switch(t===a.BondType.NONE&&(r=e.aromatic&&n.aromatic?a.BondType.AROMATIC_BOND:a.BondType.SINGLE_BOND),r){case a.BondType.SINGLE_BOND:return new o(e,n,o.ORDER.SINGLE);case a.BondType.DOUBLE_BOND:return new o(e,n,o.ORDER.DOUBLE);case a.BondType.TRIPLE_BOND:return new o(e,n,o.ORDER.TRIPLE);case a.BondType.AROMATIC_BOND:var i=new o(e,n);return i.aromatic=!0,i;case a.BondType.ANY:default:throw new Error("invalid bond type ["+t+"]")}},a.setChiralCenters=function(t,e){for(var n=0,r=e.length;r>n;n++){var i=e[n],s=t.getAtom(i);if(void 0!==s){var u=e[++n],c=(e[++n],[]),l=0,f=null;t.atoms.forEach(function(e){var n=t.findBond(s,e);null!==n&&void 0!==n&&(n.source!==s&&(n.source=s,n.target=e),l++,t.isBondInRing(n)||c.push(n))});var d=c.length;if((3===l||4===l)&&d>0){var h=0;(3===l&&d>1||4===l&&d>2)&&(h=1),f=c[h],u===a.BondStereo.CLOCKWISE?f.stereo=o.STEREO.UP:f.stereo=o.STEREO.DOWN}4===l&&d>1&&(h=1,4===d?h=3:4===d&&(h=2),f=c[h],u===a.BondStereo.CLOCKWISE?f.stereo=o.STEREO.DOWN:f.stereo=o.STEREO.UP)}}},a.periodicTable={H:{number:1,name:"Hydrogen"},He:{number:2,name:"Helium"},Li:{number:3,name:"Lithium"},Be:{number:4,name:"Beryllium"},B:{number:5,name:"Boron"},C:{number:6,name:"Carbon"},c:{number:6,name:"Carbon"},N:{number:7,name:"Nitrogen"},n:{number:7,name:"Nitrogen"},O:{number:8,name:"Oxygen"},o:{number:8,name:"Oxygen"},F:{number:9,name:"Fluorine"},Ne:{number:10,name:"Neon"},Na:{number:11,name:"Sodium"},Mg:{number:12,name:"Magnesium"},Al:{number:13,name:"Aluminium"},Si:{number:14,name:"Silicon"},P:{number:15,name:"Phosphorus"},S:{number:16,name:"Sulfur"},s:{number:16,name:"Sulfur"},Cl:{number:17,name:"Chlorine"},Ar:{number:18,name:"Argon"},K:{number:19,name:"Potassium"},Ca:{number:20,name:"Calcium"},Sc:{number:21,name:"Scandium"},Ti:{number:22,name:"Titanium"},V:{number:23,name:"Vanadium"},Cr:{number:24,name:"Chromium"},Mn:{number:25,name:"Manganese"},Fe:{number:26,name:"Iron"},Co:{number:27,name:"Cobalt"},Ni:{number:28,name:"Nickel"},Cu:{number:29,name:"Copper"},Zn:{number:30,name:"Zinc"},Ga:{number:31,name:"Gallium"},Ge:{number:32,name:"Germanium"},As:{number:33,name:"Arsenic"},as:{number:33,name:"Arsenic"},Se:{number:34,name:"Selenium"},se:{number:34,name:"Selenium"},Br:{number:35,name:"Bromine"},Kr:{number:36,name:"Krypton"},Rb:{number:37,name:"Rubidium"},Sr:{number:38,name:"Strontium"},Y:{number:39,name:"Yttrium"},Zr:{number:40,name:"Zirconium"},Nb:{number:41,name:"Niobium"},Mo:{number:42,name:"Molybdenum"},Tc:{number:43,name:"Technetium"},Ru:{number:44,name:"Ruthenium"},Rh:{number:45,name:"Rhodium"},Pd:{number:46,name:"Palladium"},Ag:{number:47,name:"Silver"},Cd:{number:48,name:"Cadmium"},In:{number:49,name:"Indium"},Sn:{number:50,name:"Tin"},Sb:{number:51,name:"Antimony"},Te:{number:52,name:"Tellurium"},I:{number:53,name:"Iodine"},Xe:{number:54,name:"Xenon"},Cs:{number:55,name:"Caesium"},Ba:{number:56,name:"Barium"},La:{number:57,name:"Lanthanum"},Ce:{number:58,name:"Cerium"},Pr:{number:59,name:"Praseodymium"},Nd:{number:60,name:"Neodymium"},Pm:{number:61,name:"Promethium"},Sm:{number:62,name:"Samarium"},Eu:{number:63,name:"Europium"},Gd:{number:64,name:"Gadolinium"},Tb:{number:65,name:"Terbium"},Dy:{number:66,name:"Dysprosium"},Ho:{number:67,name:"Holmium"},Er:{number:68,name:"Erbium"},Tm:{number:69,name:"Thulium"},Yb:{number:70,name:"Ytterbium"},Lu:{number:71,name:"Lutetium"},Hf:{number:72,name:"Hafnium"},Ta:{number:73,name:"Tantalum"},W:{number:74,name:"Tungsten"},Re:{number:75,name:"Rhenium"},Os:{number:76,name:"Osmium"},Ir:{number:77,name:"Iridium"},Pt:{number:78,name:"Platinum"},Au:{number:79,name:"Gold"},Hg:{number:80,name:"Mercury"},Tl:{number:81,name:"Thallium"},Pb:{number:82,name:"Lead"},Bi:{number:83,name:"Bismuth"},Po:{number:84,name:"Polonium"},At:{number:85,name:"Astatine"},Rn:{number:86,name:"Radon"},Fr:{number:87,name:"Francium"},Ra:{number:88,name:"Radium"},Ac:{number:89,name:"Actinium"},Th:{number:90,name:"Thorium"},Pa:{number:91,name:"Protactinium"},U:{number:92,name:"Uranium"},Np:{number:93,name:"Neptunium"},Pu:{number:94,name:"Plutonium"},Am:{number:95,name:"Americium"},Cm:{number:96,name:"Curium"},Bk:{number:97,name:"Berkelium"},Cf:{number:98,name:"Californium"},Es:{number:99,name:"Einsteinium"},Fm:{number:100,name:"Fermium"},Md:{number:101,name:"Mendelevium"},No:{number:102,name:"Nobelium"},Lr:{number:103,name:"Lawrencium"},Rf:{number:104,name:"Rutherfordium"},Db:{number:105,name:"Dubnium"},Sg:{number:106,name:"Seaborgium"},Bh:{number:107,name:"Bohrium"},Hs:{number:108,name:"Hassium"},Mt:{number:109,name:"Meitnerium"},Ds:{number:110,name:"Darmstadtium"},Rg:{number:111,name:"Roentgenium"},Cn:{number:112,name:"Copernicium"}},t.exports=a},function(t,e,n){"use strict";var r=n(5),o=n(6),i=n(7),a=n(8),s=n(9),u=function(t,e,n,r,o,a){this.symbol=t?t:"C";var u=e?e:0,c=n?n:0;this.coord=new i(u,c),this.bonds=new Set,this.charge=r?r:0,this.isotope=a?a:0,this.aromatic=o?o:!1,this.hybridization=null,this.flags=new Array(s.MAX_FLAG_INDEX+1)};u.prototype.getSymbol=function(){return this.symbol},u.prototype.getCharge=function(){return this.charge},u.prototype.countBonds=function(){return this.bonds.size},u.prototype.hydrogenCount=function(){var t=o[this.symbol],e=Array.from(this.bonds),n=e.reduce(function(t,e){return t+e.order},0),r=0;return t&&(r=t-n+this.charge),r},u.prototype.getNeighbors=function(){for(var t=this.getBonds(),e=[],n=0,r=t.length;r>n;n++)e.push(t[n].otherAtom(this));return e},u.prototype.getBonds=function(){var t=Array.from(this.bonds);return t},u.nextBondAngle=function(t){var e,n=Array.from(t.bonds);if(0===n.length)e=0;else if(1===n.length){var o;!function(){var r=n[0].otherAtom(t),i=void 0,s=a.angle(t.coord.x,t.coord.y,r.coord.x,r.coord.y),u=i.from(t.bonds).map(function(e){var n=e.otherAtom(r),o=void 0;return o=n===t?0:a.angleDifference(s,a.angle(r.coord.x,r.coord.y,n.coord.x,n.coord.y))});u.sort(),o=u[0],e=o>0?s-120:s+120}()}else if(2===n.length){var i=n.map(function(e){var n=e.otherAtom(t);return a.angle(t.coord.x,t.coord.y,n.coord.x,n.coord.y)}),s=a.angleDifference(i[0],i[1]);Math.abs(s)<180?s=180+s/2:s/=2,e=i[0]+s}else if(3===n.length){n.sort(function(e,o){return r.defaultCompare(e.otherAtom(t).Array.from(n).length,o.otherAtom(t).Array.from(n).length)});var u=n.slice(0,2),c=u.map(function(e){var n=e.otherAtom(t);return a.angle(t.coord.x,t.coord.y,n.coord.x,n.coord.y)});e=c[0]+a.angleDifference(c[0],c[1])/2}return e},u.prototype.clone=function(){return new u(this.symbol,this.coord.x,this.coord.y,this.charge,this.aromatic,this.isotope)},u.Hybridizations={S:0,SP1:1,SP2:2,SP3:3,PLANAR3:4,SP3D1:5,SP3D2:6,SP3D3:7,SP3D4:8,SP3D5:9},u.prototype.setFlag=function(t,e){this.flags[t]=e},u.prototype.toString=function(){return"ModelAtom ["+this.symbol+"] "+this.coord.toString()},t.exports=u},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(){n(this,t)}return r(t,null,[{key:"empty",value:function e(t){var e=new Array(t);return e}},{key:"zeros",value:function(t){var e=this.empty(t);return e.fill(0),e}},{key:"full",value:function(t,e){var n=this.empty(t);return n.fill(e),n}},{key:"diff",value:function(t,e){var n=t.filter(function(t){return e.indexOf(t)<0});return n}},{key:"remove",value:function(t,e){return t.indexOf(e)>=0&&t.splice(t.indexOf(e),1),t}},{key:"flatten",value:function(){for(var t=[],e=arguments.length,n=Array(e),r=0;e>r;r++)n[r]=arguments[r];for(var o=0;o<n.length;o++)n[o]instanceof Array?t.push.apply(t,this.flatten.apply(this,n[o])):t.push(n[o]);return t}},{key:"last",value:function(t){return t[t.length-1]}},{key:"defaultCompare",value:function(t,e){var n=void 0;return n=t>e?1:e>t?-1:0}}]),t}();t.exports=o},function(t,e){"use strict";var n={C:4,Si:4,N:3,P:3,O:2,S:2,H:1,Br:1,Cl:1,I:1,F:1};t.exports=n},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(e,r){n(this,t),e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],r=arguments.length<=1||void 0===arguments[1]?0:arguments[1],this.x=e,this.y=r}return r(t,null,[{key:"distance",value:function(t,e){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}},{key:"sum",value:function(e,n){return new t(e.x+n.x,e.y+n.y)}}]),t}();t.exports=o},function(t,e){"use strict";var n={};n.angle=function(t,e,r,o){return n.standardAngle(n.toDegrees(Math.atan2(o-e,r-t)))},n.standardAngle=function(t){return n.modulo(t,360)},n.modulo=function(t,e){var n=t%e;return 0>n*e?n+e:n},n.toRadians=function(t){return t*Math.PI/180},n.toDegrees=function(t){return 180*t/Math.PI},n.angleDifference=function(t,e){var r=n.standardAngle(e)-n.standardAngle(t);return r>180?r-=360:-180>=r&&(r+=360),r},n.angleDx=function(t,e){return e*Math.cos(n.toRadians(t))},n.angleDy=function(t,e){return e*Math.sin(n.toRadians(t))},t.exports=n},function(t,e){"use strict";var n={ISPLACED:0,VISITED:1,ISINRING:2,MAX_FLAG_INDEX:2};t.exports=n},function(t,e,n){"use strict";var r=n(7),o=function i(t,e,n,r,o,a){this.source=t,this.target=e,this.order=n?n:i.ORDER.SINGLE,this.stereo=r?r:i.STEREO.NOT_STEREO,this.aromatic=o?o:!1,this.molecule=a?a:null};o.prototype.otherAtom=function(t){return t===this.source?this.target:t===this.target?this.source:null},o.prototype.getLength=function(){return r.distance(this.source.coord,this.target.coord)},o.prototype.clone=function(){return new o(this.source,this.target,this.order,this.stereo,this.aromatic,this.molecule)},o.prototype.deepClone=function(){return new o(this.source.clone(),this.target.clone(),this.order,this.stereo,this.aromatic,this.molecule)},o.ORDER={SINGLE:1,DOUBLE:2,TRIPLE:3,QUADRUPLE:4},o.STEREO={NOT_STEREO:10,UP:11,UP_OR_DOWN:12,DOWN:13},o.prototype.toString=function(){var t=this.molecule?this.molecule.name:"no molecule";return"ModelBond["+this.order+", "+this.stereo+"]  "+this.source.toString()+" -- "+this.target.toString()+" mol: "+t},t.exports=o},function(t,e,n){"use strict";var r=n(12),o=n(17),i=n(7),a=n(18),s=n(8),u=n(5),c=n(4),l=n(10),f=n(19),d=function(t){this.bonds=[],this.atoms=[],this.name=t?t:"",this.id=void 0,this.sssr=[],this.mustRecalcSSSR=!0,this.fragments=[],this.fragmentCount=0};d.prototype.resetRingCenters=function(){this.getRings().forEach(function(t){t.resetRingCenter()})},d.prototype.addBond=function(t){var e=this.indexOfAtom(t.source),n=this.indexOfAtom(t.target);if(this.fragments[e]!==this.fragments[n]){var r=void 0,o=void 0;this.fragments[e]<this.fragments[n]?(r=this.fragments[e],o=this.fragments[n]):(o=this.fragments[e],r=this.fragments[n]),this.fragmentCount--;for(var i=0,a=this.atoms.length;a>i;i++)this.fragments[i]===r&&(this.fragments[i]=o)}this.bonds.push(t),t.source.bonds.add(t),t.target.bonds.add(t),this.addAtom(t.source),this.addAtom(t.target),t.molecule=this},d.prototype.getAtom=function(t){return this.atoms[t]},d.prototype.getBond=function(t){return this.bonds[t]},d.prototype.getAverageBondLength=function(){var t=1.25;if(this.bonds.length){var e=this.bonds.reduce(function(t,e){return t+e.getLength()},0);t=e/this.bonds.length}return t},d.prototype.findBond=function(t,e){for(var n=Array.from(t.bonds),r=0,o=n.length;o>r;r++){var i=n[r];if(i.otherAtom(t)===e)return i}return null},d.prototype.indexOfAtom=function(t){return this.atoms.indexOf(t)},d.prototype.indexOfBond=function(t){return this.bonds.indexOf(t)},d.prototype.removeAtom=function(t){var e;t.constructor===Number?e=this.atoms[t]:t.constructor===c&&(e=t);var n=Array.from(e.bonds);n.forEach(function(t){u.remove(this.bonds,t)},this),e.bonds.clear(),u.remove(this.atoms,e),e.molecule=void 0},d.prototype.removeBond=function(t){var e=void 0,n=void 0;e=t.constructor===Number?this.bonds[t]:t,e.source.bonds.remove(e),e.target.bonds.remove(e),0===e.source.Array.from(n).length&&(u.remove(this.atoms,e.source),e.source.molecule=void 0),0===e.target.Array.from(n).length&&(u.remove(this.atoms,e.target),e.target.molecule=void 0),u.remove(this.bonds,e),e.molecule=void 0,e.source=void 0,e.target=void 0},d.prototype.countAtoms=function(){return this.atoms.length},d.prototype.countBonds=function(){return this.bonds.length},d.prototype.addAtom=function(t){if(!this.atoms.includes(t)){var e=this.atoms.length;this.fragmentCount++,this.fragments[e]=this.fragmentCount,this.atoms.push(t),t.molecule=this}},d.prototype.getRings=function(){return this.mustRecalcSSSR&&(this.sssr=f.findRings(this),this.mustRecalcSSSR=!1),this.sssr},d.prototype.isAtomInRing=function(t){for(var e=this.getRings(),n=0,r=e.length;r>n;n++)for(var o=0,i=e[n].atoms.length;i>o;o++)if(t===e[n].atoms[o])return!0;return!1},d.prototype.isBondInRing=function(t){for(var e=this.getRings(),n=0,r=e.length;r>n;n++)for(var o=0,i=e[n].bonds.length;i>o;o++)if(t===e[n].bonds[o])return!0;return!1},d.prototype.clone=function(){var t=new d(this.name);return this.atoms.forEach(function(e){t.addAtom(e)}),this.bonds.forEach(function(e){t.addBond(e)}),t},d.prototype.getFragments=function(){var t=this.clone();if(1===t.fragmentCount)return[t];var e=new Map;return t.atoms.forEach(function(n){var r=t.fragments[t.indexOfAtom(n)];e.has(r)===!1&&e.set(r,new d),e.get(r).addAtom(n)}),t.bonds.forEach(function(n){var r=t.fragments[t.indexOfAtom(n.source)];e.get(r).addBond(n)}),e.getValues()},d.prototype.getConnectedBondsList=function(t){for(var e=[],n=this.bonds.length,r=0;n>r;r++)this.bonds[r].source!==t&&this.bonds[r].target!==t||e.push(this.bonds[r]);return e},d.prototype.toString=function(){return"ModelMolecule - name: "+this.name+"\n	"+this.atoms.map(function(t){return" "+this.indexOfAtom(t)+": "+t.toString()},this).join("\n	")+"\n	"+this.bonds.map(function(t){return" "+this.indexOfAtom(t.source)+", "+this.indexOfAtom(t.target)+":  "+t.toString()},this).join("\n	")+"\n	"+this.getRings().map(function(t){return t.toString()}).join("\n	")},d.prototype.getCenter=function(){var t=this.getBoundingBox();return new i((t.left+t.right)/2,(t.top+t.bottom)/2)},d.prototype.getBoundingBox=function(){return o.boundingBox.apply(null,this.atoms.map(function(t){return t.coord}))},d.prototype.sproutFragment=function(t,e){r(this.atoms.includes(t),"attachmentAtom must belong to this molecule"),r(Object.getPrototypeOf(e.molecule)===Object.prototype,"fragAtom must belong to a molecule");var n=c.nextBondAngle(t);if(void 0!==n){var o=a.fromCoordinate(i.difference(t.coord,e.coord));e.molecule.rotate(n,e.coord),e.molecule.translate(o),d.mergeMolecules(e,t)}},d.prototype.sproutBond=function(t,e,n,r){var o=1.25,a=Array.from(t.bonds);a.length&&(o=a.reduce(function(t,e){return t+i.distance(e.source.coord,e.target.coord)},0)/a.length);var u=c.nextBondAngle(t);if(void 0!==u){var f="C";r&&(f=r);var d=new c(f,t.coord.x+s.angleDx(u,o),t.coord.y+s.angleDy(u,o)),h=new l(t,d,e,n);return this.addAtom(d),this.addBond(h),h}},t.exports=d},function(t,e,n){function r(t,e){return h.isUndefined(e)?""+e:h.isNumber(e)&&!isFinite(e)?e.toString():h.isFunction(e)||h.isRegExp(e)?e.toString():e}function o(t,e){return h.isString(t)?t.length<e?t:t.slice(0,e):t}function i(t){return o(JSON.stringify(t.actual,r),128)+" "+t.operator+" "+o(JSON.stringify(t.expected,r),128)}function a(t,e,n,r,o){throw new p.AssertionError({message:n,actual:t,expected:e,operator:r,stackStartFunction:o})}function s(t,e){t||a(t,!0,e,"==",p.ok)}function u(t,e){if(t===e)return!0;if(h.isBuffer(t)&&h.isBuffer(e)){if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}return h.isDate(t)&&h.isDate(e)?t.getTime()===e.getTime():h.isRegExp(t)&&h.isRegExp(e)?t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase:h.isObject(t)||h.isObject(e)?l(t,e):t==e}function c(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function l(t,e){if(h.isNullOrUndefined(t)||h.isNullOrUndefined(e))return!1;if(t.prototype!==e.prototype)return!1;if(h.isPrimitive(t)||h.isPrimitive(e))return t===e;var n=c(t),r=c(e);if(n&&!r||!n&&r)return!1;if(n)return t=m.call(t),e=m.call(e),u(t,e);var o,i,a=y(t),s=y(e);if(a.length!=s.length)return!1;for(a.sort(),s.sort(),i=a.length-1;i>=0;i--)if(a[i]!=s[i])return!1;for(i=a.length-1;i>=0;i--)if(o=a[i],!u(t[o],e[o]))return!1;return!0}function f(t,e){return t&&e?"[object RegExp]"==Object.prototype.toString.call(e)?e.test(t):t instanceof e?!0:e.call({},t)===!0:!1}function d(t,e,n,r){var o;h.isString(n)&&(r=n,n=null);try{e()}catch(i){o=i}if(r=(n&&n.name?" ("+n.name+").":".")+(r?" "+r:"."),t&&!o&&a(o,n,"Missing expected exception"+r),!t&&f(o,n)&&a(o,n,"Got unwanted exception"+r),t&&o&&n&&!f(o,n)||!t&&o)throw o}var h=n(13),m=Array.prototype.slice,g=Object.prototype.hasOwnProperty,p=t.exports=s;p.AssertionError=function(t){this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=i(this),this.generatedMessage=!0);var e=t.stackStartFunction||a;if(Error.captureStackTrace)Error.captureStackTrace(this,e);else{var n=new Error;if(n.stack){var r=n.stack,o=e.name,s=r.indexOf("\n"+o);if(s>=0){var u=r.indexOf("\n",s+1);r=r.substring(u+1)}this.stack=r}}},h.inherits(p.AssertionError,Error),p.fail=a,p.ok=s,p.equal=function(t,e,n){t!=e&&a(t,e,n,"==",p.equal)},p.notEqual=function(t,e,n){t==e&&a(t,e,n,"!=",p.notEqual)},p.deepEqual=function(t,e,n){u(t,e)||a(t,e,n,"deepEqual",p.deepEqual)},p.notDeepEqual=function(t,e,n){u(t,e)&&a(t,e,n,"notDeepEqual",p.notDeepEqual)},p.strictEqual=function(t,e,n){t!==e&&a(t,e,n,"===",p.strictEqual)},p.notStrictEqual=function(t,e,n){t===e&&a(t,e,n,"!==",p.notStrictEqual)},p["throws"]=function(t,e,n){d.apply(this,[!0].concat(m.call(arguments)))},p.doesNotThrow=function(t,e){d.apply(this,[!1].concat(m.call(arguments)))},p.ifError=function(t){if(t)throw t};var y=Object.keys||function(t){var e=[];for(var n in t)g.call(t,n)&&e.push(n);return e}},function(t,e,n){(function(t,r){function o(t,n){var r={seen:[],stylize:a};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),g(n)?r.showHidden=n:n&&e._extend(r,n),A(r.showHidden)&&(r.showHidden=!1),A(r.depth)&&(r.depth=2),A(r.colors)&&(r.colors=!1),A(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=i),u(r,t,r.depth)}function i(t,e){var n=o.styles[e];return n?"["+o.colors[n][0]+"m"+t+"["+o.colors[n][1]+"m":t}function a(t,e){return t}function s(t){var e={};return t.forEach(function(t,n){e[t]=!0}),e}function u(t,n,r){if(t.customInspect&&n&&B(n.inspect)&&n.inspect!==e.inspect&&(!n.constructor||n.constructor.prototype!==n)){var o=n.inspect(r,t);return b(o)||(o=u(t,o,r)),o}var i=c(t,n);if(i)return i;var a=Object.keys(n),g=s(a);if(t.showHidden&&(a=Object.getOwnPropertyNames(n)),E(n)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return l(n);if(0===a.length){if(B(n)){var p=n.name?": "+n.name:"";return t.stylize("[Function"+p+"]","special")}if(w(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(C(n))return t.stylize(Date.prototype.toString.call(n),"date");if(E(n))return l(n)}var y="",v=!1,x=["{","}"];if(m(n)&&(v=!0,x=["[","]"]),B(n)){var A=n.name?": "+n.name:"";y=" [Function"+A+"]"}if(w(n)&&(y=" "+RegExp.prototype.toString.call(n)),C(n)&&(y=" "+Date.prototype.toUTCString.call(n)),E(n)&&(y=" "+l(n)),0===a.length&&(!v||0==n.length))return x[0]+y+x[1];if(0>r)return w(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special");t.seen.push(n);var S;return S=v?f(t,n,r,g,a):a.map(function(e){return d(t,n,r,g,e,v)}),t.seen.pop(),h(S,y,x)}function c(t,e){if(A(e))return t.stylize("undefined","undefined");if(b(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}return v(e)?t.stylize(""+e,"number"):g(e)?t.stylize(""+e,"boolean"):p(e)?t.stylize("null","null"):void 0}function l(t){return"["+Error.prototype.toString.call(t)+"]"}function f(t,e,n,r,o){for(var i=[],a=0,s=e.length;s>a;++a)D(e,String(a))?i.push(d(t,e,n,r,String(a),!0)):i.push("");return o.forEach(function(o){o.match(/^\d+$/)||i.push(d(t,e,n,r,o,!0))}),i}function d(t,e,n,r,o,i){var a,s,c;if(c=Object.getOwnPropertyDescriptor(e,o)||{value:e[o]},c.get?s=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(s=t.stylize("[Setter]","special")),D(r,o)||(a="["+o+"]"),s||(t.seen.indexOf(c.value)<0?(s=p(n)?u(t,c.value,null):u(t,c.value,n-1),s.indexOf("\n")>-1&&(s=i?s.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+s.split("\n").map(function(t){return"   "+t}).join("\n"))):s=t.stylize("[Circular]","special")),A(a)){if(i&&o.match(/^\d+$/))return s;a=JSON.stringify(""+o),a.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+s}function h(t,e,n){var r=0,o=t.reduce(function(t,e){return r++,e.indexOf("\n")>=0&&r++,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);return o>60?n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1]:n[0]+e+" "+t.join(", ")+" "+n[1]}function m(t){return Array.isArray(t)}function g(t){return"boolean"==typeof t}function p(t){return null===t}function y(t){return null==t}function v(t){return"number"==typeof t}function b(t){return"string"==typeof t}function x(t){return"symbol"==typeof t}function A(t){return void 0===t}function w(t){return S(t)&&"[object RegExp]"===O(t)}function S(t){return"object"==typeof t&&null!==t}function C(t){return S(t)&&"[object Date]"===O(t)}function E(t){return S(t)&&("[object Error]"===O(t)||t instanceof Error)}function B(t){return"function"==typeof t}function P(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||"undefined"==typeof t}function O(t){return Object.prototype.toString.call(t)}function I(t){return 10>t?"0"+t.toString(10):t.toString(10)}function R(){var t=new Date,e=[I(t.getHours()),I(t.getMinutes()),I(t.getSeconds())].join(":");return[t.getDate(),T[t.getMonth()],e].join(" ")}function D(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var N=/%[sdj%]/g;e.format=function(t){if(!b(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(o(arguments[n]));return e.join(" ")}for(var n=1,r=arguments,i=r.length,a=String(t).replace(N,function(t){if("%%"===t)return"%";if(n>=i)return t;switch(t){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return t}}),s=r[n];i>n;s=r[++n])a+=p(s)||!S(s)?" "+s:" "+o(s);return a},e.deprecate=function(n,o){function i(){if(!a){if(r.throwDeprecation)throw new Error(o);r.traceDeprecation?console.trace(o):console.error(o),a=!0}return n.apply(this,arguments)}if(A(t.process))return function(){return e.deprecate(n,o).apply(this,arguments)};if(r.noDeprecation===!0)return n;var a=!1;return i};var L,M={};e.debuglog=function(t){if(A(L)&&(L=r.env.NODE_DEBUG||""),t=t.toUpperCase(),!M[t])if(new RegExp("\\b"+t+"\\b","i").test(L)){var n=r.pid;M[t]=function(){var r=e.format.apply(e,arguments);console.error("%s %d: %s",t,n,r)}}else M[t]=function(){};return M[t]},e.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=m,e.isBoolean=g,e.isNull=p,e.isNullOrUndefined=y,e.isNumber=v,e.isString=b,e.isSymbol=x,e.isUndefined=A,e.isRegExp=w,e.isObject=S,e.isDate=C,e.isError=E,e.isFunction=B,e.isPrimitive=P,e.isBuffer=n(15);var T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];e.log=function(){console.log("%s - %s",R(),e.format.apply(e,arguments))},e.inherits=n(16),e._extend=function(t,e){if(!e||!S(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t}}).call(e,function(){return this}(),n(14))},function(t,e){function n(){c=!1,a.length?u=a.concat(u):l=-1,u.length&&r()}function r(){if(!c){var t=setTimeout(n);c=!0;for(var e=u.length;e;){for(a=u,u=[];++l<e;)a&&a[l].run();l=-1,e=u.length}a=null,c=!1,clearTimeout(t)}}function o(t,e){this.fun=t,this.array=e}function i(){}var a,s=t.exports={},u=[],c=!1,l=-1;s.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new o(t,e)),1!==u.length||c||setTimeout(r,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=i,s.addListener=i,s.once=i,s.off=i,s.removeListener=i,s.removeAllListeners=i,s.emit=i,s.binding=function(t){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(t){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(e,r,o,i){n(this,t),this.top=e,this.right=r,this.bottom=o,this.left=i}return r(t,[{key:"expandToIncludeCoordinate",value:function(t){this.top=Math.min(this.top,t.y),this.right=Math.max(this.right,t.x),this.bottom=Math.max(this.bottom,t.y),this.left=Math.min(this.left,t.x)}}],[{key:"boundingBox",value:function(){for(var e=arguments.length,n=Array(e),r=0;e>r;r++)n[r]=arguments[r];
for(var o=n[0],i=new t(o.y,o.x,o.y,o.x),a=1;a<n.length;a++)i.expandToIncludeCoordinate(n[a]);return i}}]),t}();t.exports=o},function(t,e){"use strict";var n=function(t,e){arguments.length>0&&(this.x=t,this.y=e)};n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.dot=function(t){return this.x*t.x+this.y*t.y},n.prototype.cross=function(t){return this.x*t.y-this.y*t.x},n.prototype.unit=function(){return this.divide(this.length())},n.prototype.unitEquals=function(){return this.divideEquals(this.length()),this},n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.addEquals=function(t){return this.x+=t.x,this.y+=t.y,this},n.prototype.subtract=function(t){return new n(this.x-t.x,this.y-t.y)},n.prototype.subtractEquals=function(t){return this.x-=t.x,this.y-=t.y,this},n.prototype.multiply=function(t){return new n(this.x*t,this.y*t)},n.prototype.multiplyEquals=function(t){return this.x*=t,this.y*=t,this},n.prototype.divide=function(t){return new n(this.x/t,this.y/t)},n.prototype.divideEquals=function(t){return this.x/=t,this.y/=t,this},n.prototype.perp=function(){return new n(-this.y,this.x)},n.prototype.perpendicular=function(t){return this.subtract(this.project(t))},n.prototype.project=function(t){var e=this.dot(t)/t.dot(t);return t.multiply(e)},n.prototype.toString=function(){return this.x+","+this.y},n.fromPoints=function(t,e){return new n(e.x-t.x,e.y-t.y)},n.prototype.scale=function(t){this.x*=t,this.y*=t},n.prototype.normalize=function(){var t=1/Math.sqrt(this.x*this.x+this.y*this.y);this.x*=t,this.y*=t},n.prototype.sub=function(t){this.x-=t.x,this.y-=t.y},n.prototype.negate=function(t){this.x=-t.x,this.y=-t.y},n.prototype.negate=function(){this.x=-this.x,this.y=-this.y},n.prototype.angle=function(t){var e=this.dot(t)/(this.length()*t.length());return-1>e&&(e=-1),e>1&&(e=1),Math.acos(e)},t.exports=n},function(t,e,n){"use strict";var r=n(4),o=n(10),i=n(5),a=n(20),s=n(21),u=n(24),c=function(){};c.createRing=function(t,e){for(var n=[],r=0,o=t.length;o>r;r++)n.push(e.getAtom(t[r]));for(var i=[],s=0,u=n.length-1;u>s;s++){var c=e.findBond(n[s],n[s+1]);null!==c&&i.push(c)}var l=e.findBond(n[0],n[n.length-1]);return null!==l&&i.push(l),new a(n,i)},c.isCandidateInSet=function(t,e,n,r){for(var o=0,i=e.length;i>o;o++){var a=e[o];if(t.length>=a.length){for(var s=!0,u=0;u<a.length;u++)t.includes(a[u])||(s=!1);if(s)return!0}for(var c=0;c<t.length;c++)a.includes(t[c])&&r[c]++}for(var l=!1,f=0,d=t.length;d>f;f++)r[t[f]]<n[t[f]]-1&&(l=!0);if(l){for(var h=0,m=t.length;m>h;h++)r[t[h]]++;return!1}return!0},c.verifySSSR=function(t,e,n){for(var r=[],o=[],a=0,s=n.countAtoms();s>a;a++)o.push(n.getAtom(a).countBonds());for(var c=i.zeros(n.countAtoms()),l=0,f=t.length;f>l;l++){var d=t[l];if(!u.isCandidateInSet(d,r,o,c)&&(r.push(d),r.length===e))return r}return r},c.detectRingAtoms=function(t){var e=t.countAtoms();if(e){var n=i.full(e,!1),r=[],o=t.atoms[0];o.depth=0,r.push(o);for(var a=[!0];;){if(!r.length)break;var s=r[0];r.shift();for(var u=Array.from(s.bonds),c=0,l=u.length;l>c;c++){var f=u[c],d=f.index;if(!n[d]){n[d]=!0;var h=f.otherAtom(s),m=h.index;if(a[m]){var g=[],p=void 0;if(s.depth===h.depth)g.push(s),g.push(h),p=s.depth;else{h.isInCycle=!0;for(var y=h.getNeighbors(),v=0,b=y.length;b>v;v++){var x=y[v];x.depth===h.depth-1&&g.push(x)}p=s.depth}for(;;){g[0].isInCycle=!0,g[1].isInCycle=!0,p--;for(var A=g[0].getNeighbors(),w=0,S=A.length;S>w;w++)if(A[w].depth===p){g[0]=A[w];break}for(var C=g[1].getNeighbors(),E=0,B=C.length;B>E;E++)if(C[E].depth===p){g[1]=C[E];break}if(g[0]===g[1]){g[0].isInCycle=!0;break}}}else h.depth=s.depth+1,a[m]=!0,r.push(h)}}}}},c.createRingSystems=function(t){for(var e=[],n=t.countAtoms(),a=i.full(n,!1),l=i.full(n,!1),f=i.full(n,-1),d=0,h=t.countAtoms();h>d;d++){var m=t.atoms[d];if(!a[m.index]&&m.isInCycle){var g=new t.constructor,p=[];p.push(m),a[0]=!0;var y=new r;for(y.index2=m.index,f[m.index]=0,g.addAtom(y);;){if(!p.length)break;var v=p[0];p.shift();for(var b=Array.from(v.bonds),x=0,A=b.length;A>x;x++){var w=b[x],S=w.index;if(!l[S]){l[S]=!0;var C=w.otherAtom(v),E=C.index;if(C.isInCycle)if(a[E]){var B=t.findBond(v,C),P=new o(g.atoms[f[v.index]],g.atoms[f[C.index]]);P.index2=B.index,g.addBond(P)}else{a[E]=!0,p.push(C),y=new r,y.index2=C.index,f[C.index]=g.atoms.length,g.addAtom(y);var O=new o(g.atoms[f[v.index]],y);O.index2=w.index,g.addBond(O)}}}}for(var I=0,R=g.atoms.length;R>I;I++)g.atoms[I].index=I;for(var D=0,N=g.bonds.length;N>D;D++)g.bonds[D].index=D;var L,M=g.bonds.length-g.atoms.length+1,T=s.findRings(g,6);T.length>=M?(L=c.verifySSSR(T,M,g),L.length<M&&(L=u.findRings(g))):L=u.findRings(g);for(var k=0,j=L.length;j>k;k++)for(var _=L[k],F=0,U=_.length;U>F;F++)_[F]=g.atoms[_[F]].index2;for(var z=0,G=L.length;G>z;z++)e.push(c.createRing(L[z],t))}}return e},c.findRings=function(t){var e=t.countBonds()-t.countAtoms()+t.fragmentCount;if(!e)return[];for(var n=0,r=t.atoms.length;r>n;n++){var o=t.atoms[n];o.index=n,o.depth=void 0,o.isInCycle=void 0,t.atoms[n].index=n}for(var i=0,a=t.bonds.length;a>i;i++)t.bonds[i].index=i;return c.detectRingAtoms(t),c.createRingSystems(t)},t.exports=c},function(t,e,n){"use strict";var r=n(7),o=n(9),i=function(t,e){this.atoms=t,this.bonds=e,this.flags=new Array(o.MAX_FLAG_INDEX+1),this._center=null};i.prototype.setFlag=function(t,e){this.flags[t]=e},i.prototype.getCenter=function(){if(!this._center){for(var t=0,e=0,n=0,o=this.atoms.length;o>n;n++)t+=this.atoms[n].coord.x,e+=this.atoms[n].coord.y;this._center=new r(t/this.atoms.length,e/this.atoms.length)}return this._center},i.prototype.resetRingCenter=function(){this._center=void 0},i.prototype.toString=function(){return"RingRing \n	"+this.atoms.forEach(function(t){return" "+t.toString()}.map(this).join("\n	"))+"\n	"+this.bonds.map(function(t){return" "+t.toString()},this).join("\n	")+"\n	"},t.exports=i},function(t,e,n){"use strict";var r=n(5),o=n(20),i=n(22),a=function(){};a.findRings=function(t,e){for(var n=[],r=new i(t),o=0,a=t.countAtoms();a>o;o++)for(var s=r.remove(t.getAtom(o),e),u=0;u<s.length;u++){var c=s[u],l=c.atoms;l.pop();for(var f=0,d=l.length;d>f;f++)l[f]=t.indexOfAtom(l[f]);n.push(l)}return n.sort(),n},a.createRing=function(t,e){for(var n=[],i=0,a=t.length-1;a>i;i++){var s=e.findBond(t[i],t[i+1]);null!==s&&n.push(s)}r.removeAt(t,t.length-1);var u=new o(t,n);return u},t.exports=a},function(t,e,n){"use strict";var r=n(5),o=n(23),i=function(t){this.edges=[],this.atoms=[];for(var e=0,n=t.countBonds();n>e;e++){var r=t.getBond(e),i=[r.source,r.target];this.edges.push(new o(i))}for(var a=0,s=t.countAtoms();s>a;a++)this.atoms.push(t.getAtom(a))};i.prototype.remove=function(t,e){for(var n=this.getEdges(t),o=[],i=0,a=n.length;a>i;i++)n[i].isCycle()&&o.push(n[i]);n=r.diff(n,o),this.edges=r.diff(this.edges,o);var s=this.spliceEdges(n);this.edges=r.diff(this.edges,n);for(var u=0;u<s.length;u++)!this.edges.includes(s[u])&&s[u].atoms.length<=e+1&&this.edges.push(s[u]);return r.remove(this.atoms,t),o},i.prototype.getEdges=function(t){for(var e=[],n=0,r=this.edges.length;r>n;n++){var o=this.edges[n];if(o.isCycle())o.atoms.includes(t)&&e.push(o);else{var i=o.atoms.length-1;o.atoms[0]!==t&&o.atoms[i]!==t||e.push(o)}}return e},i.prototype.spliceEdges=function(t){for(var e=[],n=0,r=t.length;r>n;n++)for(var o=n+1;r>o;o++){var i=t[o].splice(t[n]);null!==i&&e.push(i)}return e},t.exports=i},function(t,e){"use strict";var n=function(t){this.atoms=t};n.prototype.isCycle=function(){var t=this.atoms.length-1;return this.atoms.length>2&&this.atoms[0]===this.atoms[t]},n.prototype.splice=function(t){for(var e=this.getIntersection(t.atoms),r=[],o=0,i=this.atoms.length;i>o;o++)r.push(this.atoms[o]);if(this.atoms[0]===e&&r.reverse(),t.atoms[0]===e)for(var a=1,s=t.atoms.length;s>a;a++)r.push(t.atoms[a]);else for(var u=t.atoms.length-2;u>=0;u--)r.push(t.atoms[u]);return this.isRealPath(r)?new n(r):null},n.prototype.isRealPath=function(t){for(var e=1,n=t.length-1;n>e;e++)for(var r=1;n>r;r++)if(e!==r&&t[e]===t[r])return!1;return!0},n.prototype.getIntersection=function(t){var e=this.atoms.length-1,n=t.length-1;if(this.atoms[e]===t[0]||this.atoms[e]===t[n])return this.atoms[e];if(this.atoms[0]===t[0]||this.atoms[0]===t[n])return this.atoms[0];throw new Error("Couldn't splice - no intersection")},t.exports=n},function(t,e){"use strict";var n=function(){};n.deepCopy=function(t){for(var e=[],r=0,o=t.length;o>r;r++){var i=t[r];i instanceof Array?e.push(n.deepCopy(i)):e.push(i)}return e},n.matrixToHTML=function(t){for(var e="",n=t.length,r=0;n>r;r++){for(var o=0;n>o;o++)e+=JSON.stringify(t[r][o])+" ";e+="<br>"}return e},n.createEmptyMatrix=function(t){for(var e=[],n=0;t>n;n++){for(var r=[],o=0;t>o;o++)r.push(0);e.push(r)}return e},n.createWeightMatrix=function(t,e){for(var n=[],r=0;e>r;r++){for(var o=[],i=0;e>i;i++)r===i?o.push(0):t.findBond(t.getAtom(r),t.getAtom(i))?o.push(1):o.push(99999999);n.push(o)}return n},n.createEmptyPIDMatrix=function(t){for(var e=[],n=0;t>n;n++){for(var r=[],o=0;t>o;o++)r.push([]);e.push(r)}return e},n.createPIDMatrix=function(t,e){for(var n=[],r=0;e>r;r++){for(var o=[],i=0;e>i;i++){var a=t.getAtom(r),s=t.getAtom(i),u=t.findBond(a,s);u?o.push([[t.indexOfBond(u)]]):o.push([])}n.push(o)}return n},n.appendPath=function(t,e,n){t.length?t.push(e[0].concat(n[0])):t[0]=e[0].concat(n[0])},n.makePIDMatrixes=function(t){for(var e=t.countAtoms(),r=n.createWeightMatrix(t,e),o=n.createPIDMatrix(t,e),i=n.createEmptyPIDMatrix(e),a=r,s=0;e>s;s++)for(var u=0;e>u;u++)for(var c=0;e>c;c++){var l=a[u][c],f=a[u][s]+a[s][c],d=o[u][s],h=o[s][c];1e8!==f&&(l>f?(l===f+1?i[u][c]=n.deepCopy(o[u][c]):i[u][c]=[],r[u][c]=f,o[u][c]=[d[0].concat(h[0])]):l===f?d.length&&h.length&&n.appendPath(o[u][c],d,h):l===f-1?n.appendPath(i[u][c],d,h):r[u][c]=a[u][c])}return{D:r,Pe1:o,Pe2:i}},n.sortByCnum=function(t,e){return t.Cnum-e.Cnum},n.makeCandidateSet=function(t,e,r){for(var o=t.length,i=[],a=0;o>a;a++)for(var s=0;o>s;s++)if(0!==t[a][s]&&(1!==e[a][s].length||0!==r[a][s].length)){var u;u=r[a][s].length?2*(t[a][s]+.5):2*t[a][s],i.push({Cnum:u,Pe1:e[a][s],Pe2:r[a][s]})}return i.sort(n.sortByCnum),i},n.isCandidateInSet=function(t,e,n,r){for(var o=0,i=e.length;i>o;o++){var a=e[o];if(t.length>=a.length){for(var s=!0,u=0,c=a.length;c>u;u++)t.includes(a[u])||(s=!1);if(s)return!0}for(var l=0;l<t.length;l++)a.includes(t[l])&&r[l]++}for(var f=!1,d=0;d<t.length;d++)r[t[d]]<n[t[d]]-1&&(f=!0);if(f){for(var h=0;h<t.length;h++)r[t[h]]++;return!1}return!0},n.bondRingToAtomRing=function(t,e){for(var n=[],r=0,o=t.length;o>r;r++){var i=e.getBond(t[r]),a=e.indexOfAtom(i.source),s=e.indexOfAtom(i.target);n.includes(a)||n.push(a),n.includes(s)||n.push(s)}return n},n.processCandidate=function(t,e,r,o,i){var a=n.bondRingToAtomRing(t,r);t.length===a.length&&(n.isCandidateInSet(a,e,o,i)||e.push(a))},n.candidateSearch=function(t,e,r,o){for(var i=[],a=[],s=0,u=r.countAtoms();u>s;s++)a.push(r.getAtom(s).countBonds());for(var c=[],l=0;l<r.countAtoms();l++)c[l]=0;for(var f=0,d=t.length;d>f;f++){var h=t[f];if(h.Cnum%2)for(var m=0,g=h.Pe2.length;g>m;m++){var p=h.Pe1[0].concat(h.Pe2[m]);if(n.processCandidate(p,i,r,a,c),i.length===e)return i}else for(var y=0,v=h.Pe1.length-1;v>y;y++){var b=h.Pe1[y].concat(h.Pe1[y+1]);if(n.processCandidate(b,i,r,a,c),i.length===e)return i}}return i},n.sortByPath=function(t,e){for(var n=[t[0]],r=e.getAtom(t[0]),o=0;t.length!==n.length&&(o++,!(o>1e3));)for(var i=1,a=t.length;a>i;i++){var s=e.getAtom(n[n.length-1]),u=e.getAtom(t[i]);n.includes(t[i])||(e.findBond(s,u)?n.push(t[i]):e.findBond(r,u)&&n.splice(0,0,t[i]))}return n},n.findRings=function(t){var e=t.countBonds()-t.countAtoms()+1;if(!e)return[];for(var r=n.makePIDMatrixes(t),o=n.makeCandidateSet(r.D,r.Pe1,r.Pe2),i=n.candidateSearch(o,e,t,r.D),a=0,s=i.length;s>a;a++)i[a]=n.sortByPath(i[a],t);return i},t.exports=n},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(e){n(this,t),this.molObj=this.processMolecule(e)}return r(t,[{key:"processAtom",value:function(t){var e={},n=t.coord;return e.l=t.symbol,e.x=n.x,e.y=n.y,e.c=t.charge,e}},{key:"processBond",value:function(t,e){var n={},r=t.source,o=t.target;switch(n.b=e.indexOfAtom(r),n.e=e.indexOfAtom(o),n.o=t.order,t.stereo){case 10:n.s="none";break;case 11:n.s="protuding";break;case 12:n.s="ambiguous";break;case 13:n.s="recessed";break;default:n.s="none"}return n}},{key:"processMolecule",value:function(t){var e={},n=[],r={},o=t.atoms,i=t.bonds;r.a=o.map(this.processAtom),r.b=[];for(var a=0;a<i.length;a++)r.b.push(this.processBond(i[a],t));return n[0]=r,e.m=n,e.s=[],e}},{key:"toJson",value:function(){return JSON.stringify(this.molObj)}}]),t}();t.exports=o},function(t,e,n){"use strict";var r=n(7),o=n(18),i=n(8),a=n(9),s=n(11),u=n(27),c=n(5),l=n(28),f=n(29),d=n(31),h=function(){};h.bondLength=l.bondLength,h.generate=function(t){for(var e=0,n=new o(0,1),i=t.countAtoms(),s=0;i>s;s++){var l=t.getAtom(s);l.setFlag(a.ISPLACED,!1),l.setFlag(a.VISITED,!1),l.setFlag(a.ISINRING,!1),l.setFlag(a.ISALIPHATIC,!1)}if(1===i)return t.getAtom(0).coords=new r(0,0),t;if(t.fragmentCount>1)throw Error("Molecule not connected.");var g,p=t.countBonds(),y=p-t.countAtoms()+1,v=t.getRings(),b=new u.GetPartitionedRings(v);if(y>0){v.forEach(function(t){t.atoms.forEach,function(t){t.setFlag(a.ISINRING,!0)}}),b.sort(function(t,e){return c.defaultCompare(t.length,e.length)});var x=c.last(b);this.ringSet(n,x),m.placeRingSubstituents(t,x,h.bondLength),x.forEach(function(t){t.isPlaced=!0})}else{var A=f.getInitialLongestChain(t);A.getAtom(0).coord=new r(0,0),A.getAtom(0).flags[a.ISPLACED]=!0,g=Math.PI*(-30/180),f.placeLinearChain(A,n,h.bondLength)}var e=0;do e++,h.handleAliphatics(t,p,h.bondLength),m.layoutNextRingSystem(n,t,v,b);while(!f.allPlaced(t,i)&&e<=t.countAtoms());return d.resolveOverlap(t,v),t},h.placeFirstBond=function(t,e){return e.normalize(),e.scale(h.bondLength),t.source.coord=new r(0,0),t.source.setFlag(a.ISPLACED,!0),t.target.coord=new r(e.x,e.y),t.target.setFlag(a.ISPLACED,!0),[t.source,t.target]},h.allPlaced=function(t){for(var e=0;e<t.length;e++)if(!t[e].flags[a.ISPLACED])return!1;return!0},h.getNextAtomWithAliphaticUnplacedNeigbors=function(t,e){for(var n=0;e>n;n++){var r=t.getBond(n);if(r.source.flags[a.ISPLACED]&&!r.target.flags[a.ISPLACED])return r.source;if(!r.source.flags[a.ISPLACED]&&r.target.flags[a.ISPLACED])return r.target}return null},h.getAtoms=function(t,e,n,r){for(var o=new s,i=e.getConnectedBondsList(t),u=0,c=i.length;c>u;u++){var l=i[u].otherAtom(t);r&&l.flags[a.ISPLACED]?o.addAtom(l):r||l.flags[a.ISPLACED]||o.addAtom(l)}return o},h.handleAliphatics=function(t,e,n){var r,i=0;do{i++;var s=!1;r=h.getNextAtomWithAliphaticUnplacedNeigbors(t,e);var u=null,c=null;if(null!==r){var l=h.getAtoms(r,t,e,!1),d=h.getAtoms(r,t,e,!0),m=f.getLongestUnplacedChain(t,r);if(m.countAtoms()>1){d.countAtoms()>1?(f.distributePartners(r,d,f.get2DCenter(d),l,n),u=new o(m.getAtom(1).coord.x,m.getAtom(1).coord.y),c=new o(r.coord.x,r.coord.y),u.sub(c)):u=f.getNextBondVector(r,d.getAtom(0),f.get2DCenter(t),!0);for(var g=1,p=m.countAtoms();p>g;g++)m.getAtom(g).flags[a.ISPLACED]=!1;f.placeLinearChain(m,u,n)}else s=!0}else s=!0}while(!s&&i<=t.countAtoms())},h.getMostComplexRing=function(t){for(var e=new Array(t.length),n=0;n<e.length;n++)e[n]=0;for(var r=0,o=0,i=0;i<t.length;i++)for(var a=t[i],s=0;s<a.atoms.length;s++)for(var u=a[s],c=i+1;c<t.length;c++){var l=t[c];if(a!==l)for(var f=0;f<l.atoms.length;f++){var d=l[f];if(u===d){e[i]++,e[c]++;break}}}for(var h=0;h<e.length;h++)e[h]>r&&(r=e[h],o=h);return t[o]},h.ringSet=function(t,e){var n=l.bondLength,i=h.getMostComplexRing(e);if(!i.flags[a.ISPLACED]){var s={atoms:h.placeFirstBond(i.bonds[0],t),bonds:[i.bonds[0]]},u=s.atoms.reduce(function(t,e){return r.sum(t,e.coord)},new r(0,0)),c=new o(u.x/s.atoms.length,u.y/s.atoms.length),f=m.getRingCenterOfFirstRing(i,t,n);m.placeRing(i,s,c,f,n),i.setFlag(a.ISPLACED,!0)}var d=0;do i.flags[a.ISPLACED]&&(m.placeConnectedRings(e,i,"FUSED",n),m.placeConnectedRings(e,i,"BRIDGED",n),m.placeConnectedRings(e,i,"SPIRO",n)),d++,d===e.length&&(d=0),i=e[d];while(!h.allPlaced(e))};var m=function(){};m.getRingCenterOfFirstRing=function(t,e,n){var r=t.atoms.length,i=n/(2*Math.sin(Math.PI/r)),a=Math.sqrt(Math.pow(i,2)-Math.pow(n/2,2)),s=f.getAngle(e.x,e.y);return s+=Math.PI/2,new o(Math.cos(s)*a,Math.sin(s)*a)},m.placeRing=function(t,e,n,r,o){var i=e.atoms.length;i>2?m.placeBridgedRing(t,e,n,r,o):2===i?m.placeFusedRing(t,e,n,r,o):1===i&&m.placeSpiroRing(t,e,n,r,o)},m.placeRingSubstituents=function(t,e,n){var r=new s,o=0;return e.forEach(function(i){i.atoms.forEach(function(i){var a=new s,u=new s,l=e.filter(function(t){return t.atoms.includes(i)}),d=c.flatten(l.map(function(t){return t.atoms})),h=m.center(d);o+=f.partitionPartners(t,i,a,u),f.markNotPlaced(a.atoms),a.atoms.forEach(function(t){r.addAtom(t)}),a.atoms.length>0&&f.distributePartners(i,u,h,a,n)})}),r},m.placeBridgedRing=function(t,e,n,a,s){var u=m.getNativeRingRadius(t.atoms.length,s);a.normalize(),a.scale(u);var c=new r(n.x+a.x,n.y+a.y),l=m.getBridgeAtoms(e),d=l[0],h=l[1],g=new o(d.coord.x,d.coord.y),p=new o(h.coord.x,h.coord.y);g.sub(a),p.sub(a);var y=g.angle(p),v=2*Math.PI-y,b=v/(t.atoms.length-e.atoms.length+1),x=m.findStartAtom(a,d,h),A=i.toRadians(i.angle(x.coord.x,x.coord.y,a.x,a.y)),w=m.atomsInPlacementOrder(x,e.bonds[0],t.bonds),b=b*m.findDirection(a,d,h);f.populatePolygonCorners(w,c,A,b,u)},m.atomsInPlacementOrder=function(t,e,n){var r=n.find(function(e){return e.otherAtom(t)}),o=n.filter(function(t){return t!==r});if(o.length>0){var i=r.otherAtom(t);return[].concat.call(i,m.atomsInPlacementOrder(i,r,o))}return[]},m.findDirection=function(t,e,n){var o=1,i=r.difference(e.coord,n.coord);return 0===i.x?t.x>e.coord.x&&(o=-1):t.y-e.coord.y<(t.x-e.coord.x)*i.y/i.x&&(o=-1),o},m.findStartAtom=function(t,e,n){var o=r.difference(e.coord,n.coord);if(0===o.x){if(e.coord.y>n.coord.y)return e}else if(e.coord.x>n.coord.x)return e;return n},m.getBridgeAtoms=function(t){var e=[];return t.atoms.forEach(function(n){Array.from(n.bonds).forEach(function(r){t.bonds.includes(r)&&e.push(r.otherAtom(n))})}),e},m.placeFusedRing=function(t,e,n,i,a){var s=m.getNativeRingRadius(t.atoms.length,a),u=Math.sqrt(Math.pow(s,2)-Math.pow(a/2,2));i.normalize(),i.scale(u);var c=new r(n.x+i.x,n.y+i.y),l=e.atoms[0],d=e.atoms[1],h=new o(l.coord.x,l.coord.y),g=new o(d.coord.x,d.coord.y),p=new o(c.x,c.y);h.sub(p),g.sub(p);var y=h.angle(g),v=2*Math.PI-y,b=v/(t.atoms.length-1),x=c.x,A=c.y,w=l.coord.x-d.coord.x,S=l.coord.y-d.coord.y,C=1;if(0===w){var E;E=l.coord.y>d.coord.y?l:d,C=x<l.coord.x?1:-1}else E=l.coord.x>d.coord.x?l:d,C=A-l.coord.y>(x-l.coord.x)*S/w?1:-1;for(var B=f.getAngle(E.coord.x-c.x,E.coord.y-c.y),P=E,O=e.bonds[0],I=[],R=0,D=t.bonds.length-2;D>R;R++)O=m.getNextBond(t,O,P),P=O.otherAtom(P),I.push(P);b*=C,f.populatePolygonCorners(I,c,B,b,s)},m.getNextBond=function(t,e,n){for(var r=0;r<t.bonds.length;r++)if(t.bonds[r]!==e&&(t.bonds[r].source===n||t.bonds[r].target===n))return t.bonds[r];return null},m.placeSpiroRing=function(t,e,n,o,i){var a=m.getNativeRingRadius(t.atoms.length,i);o.normalize(),o.scale(a);var s=new r(n.x+o.x,n.y+o.y),u=2*Math.PI/t.atoms.length,c=e.atoms[0],l=f.getAngle(c.coord.x-s.x,c.coord.y-s.y),d=m.atomsInPlacementOrder(c,e.bonds[0],t.bonds);f.populatePolygonCorners(d,s,l,u,a)},m.getNativeRingRadius=function(t,e){return e/(2*Math.sin(Math.PI/t))},m.getIntersectingAtoms=function(t,e){var n=[];return e.atoms.forEach(function(e){t.atoms.includes(e)&&n.push(e)}),n},m.getIntersectingBonds=function(t,e){var n=[];return e.bonds.forEach(function(e){t.bonds.includes(e)&&n.push(e)}),n},m.center=function(t){var e=t.reduce(function(t,e){return r.sum(t,e.coord)},new r(0,0));return new r(e.x/t.length,e.y/t.length)},m.placeConnectedRings=function(t,e,n,i){for(var s=u.directConnectedRings(e,t),c=0,l=s.length;l>c;c++){var d=s[c];if(!d.flags[a.ISPLACED]){var h={atoms:m.getIntersectingAtoms(e,d),bonds:m.getIntersectingBonds(e,d)},g=h.atoms.length;if(2===g&&"FUSED"===n||1===g&&"SPIRO"===n||g>2&&"BRIDGED"===n){for(var p="",y=0;y<h.atoms.length;y++)p+="\n         "+h.atoms[y].coord+" "+h.atoms[y].flags[a.ISPLACED];var v=f.getAtoms2DCenter(h.atoms),b=f.getAtoms2DCenter(e.atoms),x=new o(v.x,v.y),A=new o(x.x,x.y);A.sub(new o(b.x,b.y));new o(A.x,A.y),new r(v.x+A.x,v.y+A.y);m.placeRing(d,h,v,A,i),d.setFlag(a.ISPLACED,!0),m.placeConnectedRings(t,d,n,i)}}}},m.resetUnplacedRingAtoms=function(t){t.forEach(function(t){t.isPlaced||t.atoms.forEach(function(t){return t.setFlag(a.ISPLACED,!1)})})},m.findNextRingBondWithUnplacedRingAtom=function(t){t.find(function(t){[t.source,t.target].some(function(e){e.flags[a.ISINRING]&&!e.flags[a.ISPLACED]&&t.otherAtom(e).flags[a.ISPLACED]})})},m.layoutNextRingSystem=function(t,e,n,r){m.resetUnplacedRingAtoms(n);var i=e.atoms.filter(function(t){return t.flags[a.ISPLACED]}),s=m.findNextRingBondWithUnplacedRingAtom(e.bonds);if(s){var u=[s.source,s.target].find(function(t){return t.flags[a.ISINRING]&&!t.flags[a.ISPLACED]}),d=s.otherAtom(u),g=r.find(function(t){return t.find(function(t){return t.atoms.includes(u)})}),p=u.coord.clone(),y=d.coord.clone();h.ringSet(t,g),f.markNotPlaced(i);var v=m.placeRingSubstituents(e,g,l.bondLength);f.markPlaced(i),i=[].concat.call(v.atoms,c.flatten(g.map(function(t){return t.atoms}))),c.removeDuplicates(i);var b=p,x=y,A=u.coord,w=d.coord,S=f.getAngle(b.x-x.x,b.y-x.y),C=f.getAngle(A.x-w.x,A.y-w.y),E=S-C,B=new o(x.x,x.y);B.sub(new o(w.x,w.y)),i.forEach(function(t){t.coord.x+=B.x,t.coord.y+=B.y});var P=Math.cos(E),O=Math.sin(E);i.forEach(function(t){var e=t.coord,n=e.x-x.x,r=e.y-x.y;e.x=n*P-r*O+x.x,e.y=n*O+r*P+x.y}),g.forEach(function(t){t.isPlaced=!0})}},t.exports=h},function(t,e,n){"use strict";var r=n(5),o=function(){};o.GetPartitionedRings=function(t){var e=[],n=t;return t.forEach(function(t){if(!r.flatten(e).find(function(e){return e===t})){var i=e.find(function(e){return e.find(function(e){return e===t})});void 0===i&&(i=[t],n=n.filter(function(e){return e!==t}));var a=o.directConnectedRings(t,n);i=[].concat(i,a),n=n.filter(function(t){return a.find(function(e){return e===t})}),e.push(i)}}),e},o.directConnectedRings=function(t,e){var n=[];return e.forEach(function(e){var r=e.atoms.some(function(n){return e===t?!1:t.atoms.find(function(t){return t===n})});r&&n.push(e)}),n},t.exports=o},function(t,e){"use strict";var n={bondLength:1.5};t.exports=n},function(t,e,n){"use strict";var r=n(7),o=n(18),i=n(9),a=n(11),s=n(30),u=function(){};u.getInitialLongestChain=function(t){for(var e=s.getMatrix(t),n=u.computeFloydAPSP(e),r=0,o=-1,i=-1,a=t.countBonds(),c=n.length,l=0;c>l;l++){var f=t.getAtom(l),d=u.getConnectedBondsCount(f,t,a);if(1===d)for(var h=0;c>h;h++)n[l][h]>r&&(r=n[l][h],o=l,i=h)}var m=t.getAtom(o),g=u.getLongestUnplacedChain(t,m);return g},u.computeFloydAPSP=function(t){for(var e=t.length,n=new Array(e),r=0;e>r;++r)n[r]=new Array(e);for(var o=0;e>o;o++)for(var i=0;e>i;i++)0===t[o][i]?n[o][i]=999999:n[o][i]=1;for(var a=0;e>a;a++)n[a][a]=0;for(var s=0;e>s;s++)for(var u=0;e>u;u++)for(var c=0;e>c;c++)n[u][s]+n[s][c]<n[u][c]&&(n[u][c]=n[u][s]+n[s][c]);return n},u.getLongestUnplacedChain=function(t,e){for(var n=0,r=0,o=0,s=0,c=[],l=t.countAtoms(),f=t.countBonds(),d=0;l>d;d++)t.getAtom(d).setFlag(i.VISITED,!1),c[d]=new a,c[d].addAtom(e);var h=[];h.push(e),e.flags[i.VISITED]=!0,u.breadthFirstSearch(t,h,c,f);for(var m=0;l>m;m++)c[m].countAtoms()>=r&&(s=u.getDegreeSum(c[m],t,f),s>o&&(o=s,n=m,r=c[m].countAtoms()));return c[n]},u.getDegreeSum=function(t,e,n){for(var r=0,o=t.countAtoms(),i=0;o>i;i++)r+=u.getConnectedBondsCount(t.getAtom(i),e,n);return r},u.getConnectedBondsCount=function(t,e,n){for(var r=0,o=0;n>o;o++)e.getBond(o).source!==t&&e.getBond(o).target!==t||r++;return r},u.breadthFirstSearch=function(t,e,n,r){for(var o=[],a=e.length,s=0;a>s;s++){var c=e[s];if(!c.flags[i.ISINRING])for(var l=t.indexOfAtom(c),f=t.getConnectedBondsList(c),d=0;d<f.length;d++){var h=f[d],m=h.otherAtom(c);if(!m.flags[i.VISITED]&&!m.flags[i.ISPLACED]){var g=t.indexOfAtom(m);n[g]=u.copyPath(n[l]),n[g].addAtom(m),n[g].addBond(h),u.getConnectedBondsCount(m,t,r)>1&&o.push(m)}}}if(o.length>0){for(var p=0;p<o.length;p++)o[p].setFlag(i.VISITED,!0);u.breadthFirstSearch(t,o,n,r)}},u.copyPath=function(t){for(var e=new a,n=0,r=t.countAtoms();r>n;n++)e.addAtom(t.getAtom(n));return e},u.placeLinearChain=function(t,e,n){for(var o=e,a=0;a<t.countAtoms()-1;a++){var s=t.getAtom(a),c=t.getAtom(a+1),l=new r(s.coord.x,s.coord.y);o.normalize(),o.scale(n),l.x+=o.x,l.y+=o.y,c.coord=l,c.setFlag(i.ISPLACED,!0);var f=!0;2===u.has2DCoordinatesNew(t)&&(f=!1),o=u.getNextBondVector(c,s,u.get2DCenter(t),f)}},u.has2DCoordinatesNew=function(t){if(null===t)return 0;var e=!1,n=!1;return t.atoms.forEach(function(t){null===t.coord||0===t.coord.x&&0===t.coord.y?e=!0:n=!0}),!e&&n?2:e&&n?1:0},u.get2DCenter=function(t){for(var e=0,n=0,o=0,a=0,s=t.countAtoms();s>a;a++){var u=t.getAtom(a);u.flags[i.ISPLACED]===!0&&(e+=u.coord.x,n+=u.coord.y,o++)}var c=new r(e/o,n/o);return c},u.getAtoms2DCenter=function(t){for(var e=0,n=0,o=0,a=0,s=t.length;s>a;a++){var u=t[a];u.flags[i.ISPLACED]===!0&&(e+=u.coord.x,n+=u.coord.y,o++)}var c=new r(e/o,n/o);return c},u.getAngle=function(t,e){var n=0;return t>=0&&e>=0?n=Math.atan(e/t):0>t&&e>=0?n=Math.PI+Math.atan(e/t):0>t&&0>e?n=Math.PI+Math.atan(e/t):t>=0&&0>e&&(n=2*Math.PI+Math.atan(e/t)),n},u.getNextBondVector=function(t,e,n,i){var a=u.getAngle(e.coord.x-t.coord.x,e.coord.y-t.coord.y),s=Math.PI*(120/180);i||(s=Math.PI*(60/180)),a+=s;var c=new o(Math.cos(a),Math.sin(a)),l=new r(t.coord.x+c.x,t.coord.y+c.y),f=r.distance(l,n);a+=s;var d=new o(Math.cos(a),Math.sin(a)),h=new r(t.coord.x+d.x,t.coord.y+d.y),m=r.distance(h,n);return m>f?d:c},u.allPlaced=function(t,e){for(var n=0;e>n;n++)if(!t.getAtom(n).flags[i.ISPLACED])return!1;return!0},u.distributePartners=function(t,e,n,i,a){var s=0,c=0,l=0,f=0,d=0,h=new o(n.x,n.y),m=new o(t.coord.x,t.coord.y),g=new o(n.x,n.y);g.sub(m);var p=[],y=e.countAtoms(),v=i.countAtoms();if(1===y){for(var b=0;v>b;b++)p.push(i.getAtom(b));l=2*Math.PI/(v+y);var x=e.getAtom(0),A=x.coord.x-t.coord.x,w=x.coord.y-t.coord.y;return c=u.getAngle(A,w),void u.populatePolygonCorners(p,new r(t.coord.x,t.coord.y),c,l,a)}if(0===y){for(var S=0;v>S;S++)p.push(i.getAtom(S));return l=2*Math.PI/v,c=0,void u.populatePolygonCorners(p,new r(t.coord.x,t.coord.y),c,l,a)}var C=[];h.sub(m),m=h,m.normalize(),m.scale(a),m.negate();var E=new r(t.coord.x,t.coord.y);E.x+=m.x,E.y+=m.y;for(var B=0;y>B;B++)C.push(e.getAtom(B));u.sortBy2DDistance(C,E);var P=new o(C[0].coord.x,C[0].coord.y),O=new o(C[1].coord.x,C[1].coord.y);P.sub(new o(t.coord.x,t.coord.y)),O.sub(new o(t.coord.x,t.coord.y)),s=P.angle(g),s+=O.angle(g);var I=u.getAngle(C[0].coord.x-t.coord.x,C[0].coord.y-t.coord.y),R=(u.getAngle(C[1].coord.x-t.coord.x,C[1].coord.y-t.coord.y),u.getAngle(E.x-t.coord.x,E.y-t.coord.y)),D=null;D=I>R?I-R<Math.PI?C[1]:C[0]:R-I<Math.PI?C[0]:C[1],d=2*Math.PI-s,l=d/(v+1);for(var N=0;v>N;N++)p.push(i.getAtom(N));f=a,c=u.getAngle(D.coord.x-t.coord.x,D.coord.y-t.coord.y),u.populatePolygonCorners(p,new r(t.coord.x,t.coord.y),c,l,f)},u.sortBy2DDistance=function(t,e){var n;do{n=!1;for(var o=0,i=t.length;i-1>o;o++){var a=t[o],s=t[o+1],u=r.distance(e,a.coord),c=r.distance(e,s.coord);u>c&&(t[o]=s,t[o+1]=a,n=!0)}}while(n)},u.populatePolygonCorners=function(t,e,n,o,a){for(var s=[],u=n,c=0,l=t.length;l>c;c++){u+=o,u>=2*Math.PI&&(u-=2*Math.PI);var f=t[c];"H"===f.symbol&&(a*=.6);var d=Math.cos(u)*a,h=Math.sin(u)*a,m=d+e.x,g=h+e.y;s.push(new r(m,g))}for(var p=0;p<t.length;p++)f=t[p],f.coord=s[p],f.flags[i.ISPLACED]=!0},u.partitionPartners=function(t,e,n,r){var o=0;return Array.from(e.bonds).forEach(function(t){o++;var a=t.otherAtom(e);a.flags[i.ISPLACED]?r.addAtom(a):n.addAtom(a)}),o},u.markNotPlaced=function(t){t.forEach(function(t){return t.setFlag(i.ISPLACED,!1)})},u.markPlaced=function(t){t.forEach(function(t){return t.setFlag(i.ISPLACED,!0)})},t.exports=u},function(t,e){"use strict";var n=function(){};n.getMatrix=function(t){for(var e,n,r=t.countAtoms(),o=new Array(r),i=0;r>i;++i){o[i]=new Array(r);for(var a=0;r>a;a++)o[i][a]=0}for(var s=t.countBonds(),u=0;s>u;u++){var c=t.getBond(u);e=t.indexOfAtom(c.source),n=t.indexOfAtom(c.target),o[e][n]=1,o[n][e]=1}return o},n.display=function(t){for(var e="",n=t.length,r=0;n>r;r++){for(var o=0;n>o;o++)e+=void 0==t[r][o]?"[ ]":"["+t[r][o]+"]";e+="\n"}alert(e)},t.exports=n},function(t,e,n){"use strict";var r=n(7),o=n(18),i=n(26),a=function(){};a.resolveOverlap=function(t,e){var n=[],r=a.getOverlapScore(t,n);return r>0&&(r=a.displace(t,n)),r},a.getOverlapScore=function(t,e){for(var n=0,o=i.bondLength/5,a=t.countAtoms(),s=0;a>s;s++)for(var u=t.getAtom(s),c=u.coord,l=s+1;a>l;l++){var f=t.getAtom(l),d=f.coord,h=r.distance(c,d);o>h&&(n+=o,e.push(new Array(u,f)))}return n},a.displace=function(t,e){var n=25,r=0;do{var s=Math.round(Math.random()*e.length);s>=e.length&&(s=e.length-1);var u=e[s];if(void 0!==u){var c=u[0],l=u[1],f=(new o(c.coord.x,c.coord.y),new o(l.coord.x-c.coord.x,l.coord.y-c.coord.y));f.normalize(),isNaN(f.x)&&(f.x=.01),isNaN(f.y)&&(f.y=.01),f.scale(-1*i.bondLength/3);var d=Math.random();d>.5?(l.coord.x+=f.x,l.coord.y+=f.y):(c.coord.x-=f.x,c.coord.y-=f.y);var h=a.getOverlapScore(t,e);r++}else alert("problem layoutOverlapResolver.displace p is "+s+" and len "+e.length+" and "+u)}while(h>0&&!(r>n));return h},t.exports=a},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(33),a=n(34),s="",u=function(){function t(e){r(this,t),this.config=i,this.mol=e,this.sizeCalculator()}return o(t,[{key:"sizeCalculator",value:function(){this.scale=this.config.bondLength/this.mol.getAverageBondLength();var t=this.scale*this.config.marginWidth,e=this.mol.getBoundingBox();this.dx=this.scale*e.left-t,this.dy=this.scale*e.top-t,this.w=this.scale*(e.right-e.left)+2*t,this.h=this.scale*(e.bottom-e.top)+2*t}},{key:"writeHeader",value:function(t){s="\n<svg version='1.2'\n    baseProfile='full'\n    width='"+this.w+"' height='"+this.h+'\'\n    xmlns=\'http://www.w3.org/2000/svg\'\n    x="0" y="0"\n    font-family="sans-serif"\n    font-size=\''+this.config.fontSize+'\'\n    stroke="rgb(0,0,0)" stroke-width="'+this.config.lineWidth+"\"\n    stroke-linecap=\"round\">\n<defs>\n    <filter x='-0.05' y='0' width='1.3' height='1.3' id='solid-bg'>\n        <feFlood flood-color='"+t+"'/>\n        <feComposite in='SourceGraphic'/>\n    </filter>\n</defs>\n\n<rect width='100%' height='100%' fill='"+t+"' stroke='black'/>\n  "}},{key:"_drawAtom",value:function(t){var e=this.config.fontSize,n=t.symbol,r=t.coord,o=t.hydrogenCount(),i=new a(t).getHydrogenPosition(),u=r.x*this.scale-this.dx,c=r.y*this.scale-this.dy;if(u-=e/2.5,c+=3*e/8,s+="<text x='"+u+"' y='"+c+"' filter='url(#solid-bg)'>"+n+"</text>\n",o>0){var l=9*e/10,f=e/2;"Left"===i?o>1?(s+="<text x='"+(u-2*l)+"' y='"+c+"' filter='url(#solid-bg)'>H</text>\n",s+="<text x='"+(u-1*l)+"' y='"+(c+f)+"' filter='url(#solid-bg)'>"+o+"</text>\n"):s+="<text x='"+(u-l)+"' y='"+c+"' filter='url(#solid-bg)'>H</text>\n":(s+="<text x='"+(u+l)+"' y='"+c+"' filter='url(#solid-bg)'>H</text>\n",o>1&&(s+="<text x='"+(u+2*l)+"' y='"+(c+f)+"' filter='url(#solid-bg)'>"+o+"</text>\n"))}}},{key:"_selectAtom",value:function(t){var e=this.config;switch(e.displayCarbonLabels){case"all":return t;case"none":return"C"===t.symbol?!1:t;case"terminal":default:var n=!1;return("C"!==t.symbol||"C"===t.symbol&&t.getNeighbors().length<2)&&(n=t),n}
}},{key:"drawAtoms",value:function(){var t=this.mol.atoms.filter(this._selectAtom,this);t.forEach(this._drawAtom,this)}},{key:"_drawBond",value:function(t){var e=this.config.bondSpacing,n=t.source.coord.x*this.scale-this.dx,r=t.source.coord.y*this.scale-this.dy,o=t.target.coord.x*this.scale-this.dx,i=t.target.coord.y*this.scale-this.dy;1===t.order?s+="<line x1='"+n+"' y1='"+r+"' x2='"+o+"' y2='"+i+"'/>\n ":2===t.order&&(r+=e/2,i+=e/2,s+="<line x1='"+n+"' y1='"+r+"' x2='"+o+"' y2='"+i+"'/>\n ",r-=e,i-=e,s+="<line x1='"+n+"' y1='"+r+"' x2='"+o+"' y2='"+i+"'/>\n")}},{key:"drawBonds",value:function(){this.mol.bonds.forEach(this._drawBond,this)}},{key:"toSvg",value:function(){return this.writeHeader(this.config.bgColor),s+="\n",this.drawBonds(),this.drawAtoms(),s+"</svg>"}}]),t}();t.exports=u},function(t,e){"use strict";var n=1.25,r={bgColor:"white",fontSize:10,bondLength:14.4*n,bondSpacing:2.592*n,displayCarbonLabels:"terminal",lineWidth:.6,marginWidth:1.6*n};t.exports=r},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=n(18),a=function(){function t(e){r(this,t),this.atom=e,this.vectorBonds=e.getBonds().map(function(t){var n=e,r=t.otherAtom(n);return new i(r.coord.x-n.coord.x,r.coord.y-n.coord.y)}),this.position={Right:new i(1,0),Left:new i(-1,0),Above:new i(0,1),Below:new i(0,-1)}}return o(t,[{key:"getHydrogenPosition",value:function(){var t=this.atom.getNeighbors();return t.length>2?"Right":t.length>1?this.usingCardinalDirection(this.vectorBonds):1===t.length?this.vectorBonds[0].x>.1?"Left":"Right":this.usingDefaultPlacement()}},{key:"usingDefaultPlacement",value:function(){var t=["O","S","Se","Te","F","Cl","Br","I"],e=t.includes(this.atom.symbol)?"Left":"Right";return e}},{key:"usingCardinalDirection",value:function(t){var e=Math.atan2(t[0].y+t[1].y,t[0].x+t[1].x),n=Math.round(e/(Math.PI/4));switch(n){case-4:case-3:return"Right";case-2:return"Above";case-1:case 0:case 1:return"Left";case 2:return"Below";case 3:case 4:return"Right";default:return"Right"}return"Right"}}]),t}();t.exports=a}])});